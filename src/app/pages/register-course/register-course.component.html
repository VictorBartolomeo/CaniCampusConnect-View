
<div class="card px-10 mt-10">
  <h1 class="text-3xl font-bold mb-10">Consulter les cours disponibles</h1>

  @if (selectedDog) {
    <div class="mb-4">
      <p class="mb-2">Affichage des cours disponibles pour <strong>{{selectedDog.name}}</strong> (catégorie : {{getDogAgeCategory(selectedDog)}})</p>
    </div>
  }

  <p-table
    [value]="filteredCourses"
    [paginator]="true"
    [rows]="10"
    [tableStyle]="{ 'min-width': '50rem' }"
    [rowsPerPageOptions]="[5, 10, 20]"
    rowHover="true"
    stripedRows="true"
    styleClass="mt-4"
  >
    <ng-template pTemplate="header">
      <tr>
        <th>Cours</th>
        <th>Description</th>
        <th>Coach</th>
        <th>Date</th>
        <th>Jauge</th>
        <th>Actions</th>
      </tr>
    </ng-template>

    <ng-template pTemplate="body" let-course>
      <tr>
        <td class="font-bold">{{ course.title }}</td>
        <td>{{ course.description }}</td>
        <td>{{ course.coach.firstname }} {{ course.coach.lastname }}</td>
        <td>{{ course.startDatetime | date : "dd MMMM yyyy à HH:mm" }}</td>
        <td>{{ getActiveRegistrationsCount(course) }} / {{ course.maxCapacity }}</td>
        <td class="flex gap-5">
          <div>
            <p-toast position="bottom-center"/>
            <p-confirmpopup>
              <ng-template #content let-message>
                <div class="flex flex-col items-center w-full gap-4 border-b border-surface-200 dark:border-surface-700 p-4 mb-4 pb-0">
                  <i [class]="message.icon" class="!text-6xl text-primary-500"></i>
                  <p>{{ message.message }}</p>
                </div>
              </ng-template>
            </p-confirmpopup>
            <fa-icon class="cursor-pointer text-2xl hover:opacity-80"
                     [icon]="faPaw" (click)="confirm(course, $event)" label="S'inscrire"></fa-icon>
          </div>
          <div>
            <fa-icon class="cursor-pointer text-2xl hover:opacity-80"
                     [icon]="faEye"
                     (click)="showCourseDialog(course)"
                     label="Détails"></fa-icon>

            <p-dialog header="{{ selectedCourseForDialog?.title }}"
                      [modal]="true"
                      [(visible)]="dialogVisible"
                      [style]="{ width: '50rem' }"
                      [breakpoints]="{ '1199px': '75vw', '575px': '90vw' }"
                      [maximizable]="true">
              @if (selectedCourseForDialog) {
                <div class="flex flex-col gap-4 p-4" style="height: 30rem">
                  <p><strong>Description:</strong> {{ selectedCourseForDialog.description }}</p>
                  <p><strong>Coach:</strong> {{ selectedCourseForDialog.coach.firstname }} {{ selectedCourseForDialog.coach.lastname }}</p>
                  <p><strong>Date:</strong> {{ selectedCourseForDialog.startDatetime | date : "dd MMMM yyyy" }}</p>
                  <p><strong>Horaires:</strong> {{ selectedCourseForDialog.startDatetime | date : "HH:mm" }} - {{ selectedCourseForDialog.endDatetime | date: "HH:mm" }}</p>
                  <p><strong>Jauge:</strong> {{ getActiveRegistrationsCount(selectedCourseForDialog) }} / {{ selectedCourseForDialog.maxCapacity }}</p>
                </div>
              }
              <ng-template pTemplate="footer">
                <button pButton type="button" label="Fermer" icon="pi pi-times" (click)="dialogVisible = false" class="p-button-text"></button>
              </ng-template>
            </p-dialog>
          </div>
        </td>
      </tr>
    </ng-template>

    <ng-template pTemplate="emptymessage">
      <tr>
        <td colspan="6" class="text-center p-4">
          <div class="flex flex-col items-center">
            <i class="pi pi-info-circle text-3xl text-blue-500 mb-2"></i>
            <p class="text-lg">Aucun cours disponible pour ce chien</p>
            <p class="text-sm text-gray-500">Soit tous les cours sont complets, soit votre chien est déjà inscrit à tous les cours pour lesquels il est éligible.</p>
          </div>
        </td>
      </tr>
    </ng-template>
  </p-table>
</div>
