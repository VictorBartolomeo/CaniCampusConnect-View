<p-dialog
  header="Modifier le cours"
  [(visible)]="visible"
  [modal]="true"
  [closable]="true"
  [draggable]="false"
  [resizable]="false"
  styleClass="w-full max-w-2xl"
  (onHide)="closeDialog()">

  <form [formGroup]="courseForm" (ngSubmit)="onSubmit()" class="space-y-6">

    <!-- Titre -->
    <div class="field">
      <label for="title" class="block text-sm font-medium text-gray-700 mb-2">
        Titre du cours *
      </label>
      <input
        id="title"
        type="text"
        pInputText
        formControlName="title"
        placeholder="Ex: Éducation de base niveau 1"
        class="w-full"
        [class.ng-invalid]="isFieldInvalid('title')" />

      @if (isFieldInvalid('title')) {
        <small class="text-red-600 mt-1 block">
          @if (f['title'].errors?.['required']) {
            Le titre est requis
          }
          @if (f['title'].errors?.['minlength']) {
            Le titre doit contenir au moins 3 caractères
          }
          @if (f['title'].errors?.['maxlength']) {
            Le titre ne peut pas dépasser 100 caractères
          }
        </small>
      }
    </div>

    <!-- Description -->
    <div class="field">
      <label for="description" class="block text-sm font-medium text-gray-700 mb-2">
        Description
      </label>
      <textarea
        id="description"
        pInputTextarea
        formControlName="description"
        placeholder="Description optionnelle du cours..."
        rows="3"
        class="w-full"
        [class.ng-invalid]="isFieldInvalid('description')">
      </textarea>
    </div>

    <!-- Coach et Type -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div class="field">
        <label for="coach" class="block text-sm font-medium text-gray-700 mb-2">
          Coach *
        </label>
        <p-dropdown
          id="coach"
          [options]="coaches"
          formControlName="coach"
          optionLabel="label"
          optionValue="value"
          placeholder="Sélectionner un coach"
          class="w-full"
          [class.ng-invalid]="isFieldInvalid('coach')">
        </p-dropdown>
      </div>

      <div class="field">
        <label for="courseType" class="block text-sm font-medium text-gray-700 mb-2">
          Type de cours *
        </label>
        <p-dropdown
          id="courseType"
          [options]="courseTypes"
          formControlName="courseType"
          optionLabel="label"
          optionValue="value"
          placeholder="Sélectionner un type"
          class="w-full"
          [class.ng-invalid]="isFieldInvalid('courseType')">
        </p-dropdown>
      </div>
    </div>

    <!-- Dates -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
      <div class="field">
        <label for="startDatetime" class="block text-sm font-medium text-gray-700 mb-2">
          Date et heure de début *
        </label>
        <p-calendar
          id="startDatetime"
          formControlName="startDatetime"
          [showTime]="true"
          dateFormat="dd/mm/yy"
          placeholder="Sélectionner la date"
          class="w-full"
          [class.ng-invalid]="isFieldInvalid('startDatetime')">
        </p-calendar>
      </div>

      <div class="field">
        <label for="endDatetime" class="block text-sm font-medium text-gray-700 mb-2">
          Date et heure de fin *
        </label>
        <p-calendar
          id="endDatetime"
          formControlName="endDatetime"
          [showTime]="true"
          dateFormat="dd/mm/yy"
          placeholder="Sélectionner la date"
          class="w-full"
          [class.ng-invalid]="isFieldInvalid('endDatetime')">
        </p-calendar>
      </div>
    </div>

    <!-- Capacité maximale -->
    <div class="field">
      <label for="maxCapacity" class="block text-sm font-medium text-gray-700 mb-2">
        Capacité maximale *
      </label>
      <p-inputNumber
        id="maxCapacity"
        formControlName="maxCapacity"
        [min]="1"
        [max]="50"
        placeholder="Nombre de participants"
        class="w-full"
        [class.ng-invalid]="isFieldInvalid('maxCapacity')">
      </p-inputNumber>
    </div>

  </form>

  <ng-template pTemplate="footer">
    <div class="flex justify-end gap-3">
      <button
        pButton
        label="Annuler"
        icon="pi pi-times"
        class="p-button-secondary"
        (click)="closeDialog()"
        [disabled]="loading">
      </button>
      <button
        pButton
        label="Sauvegarder"
        icon="pi pi-check"
        class="p-button-primary"
        (click)="onSubmit()"
        [disabled]="loading"
        [loading]="loading">
      </button>
    </div>
  </ng-template>

</p-dialog>
