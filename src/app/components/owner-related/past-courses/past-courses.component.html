<p-card>
  <div class="flex flex-col md:flex-row md:justify-between md:items-center mb-8 gap-4">
    <h2 class="font-bold text-xl">Historique des cours</h2>

    <div class="flex items-center flex-wrap gap-2">
      <label for="dateFilter" class="text-sm">Filtrer à partir du :</label>
      <p-calendar id="dateFilter" [(ngModel)]="dateFilter" [showIcon]="true" (onSelect)="onDateFilterChange()"
                    dateFormat="dd/mm/yy" inputStyleClass="w-full z-1" placeholder="Sélectionner une date">
      </p-calendar>
      @if (dateFilter) {
        <button pButton pButtonIcon="pi pi-times" class="p-button-text p-button-rounded p-button-sm"
                (click)="clearDateFilter()"></button>
      }
    </div>
  </div>

  <!-- Table pour desktop -->
  <div class="hidden lg:block">
    <p-table [value]="filteredRegistrations" styleClass="p-datatable-striped" [tableStyle]="{'min-width': '50rem'}">
      <ng-template pTemplate="header">
        <tr>
          <th>Date</th>
          <th>Heure</th>
          <th>Titre</th>
          <th>Type de cours</th>
          <th>Coach</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-registration>
        <tr>
          <td>{{ registration.course.startDatetime | date:'d MMMM yyyy':'':'fr' }}</td>
          <td>{{ registration.course.startDatetime | date:'HH:mm':'':'fr' }} - {{ registration.course.endDatetime | date:'HH:mm':'':'fr' }}</td>
          <td>{{ registration.course.title }}</td>
          <td>{{ registration.course.courseType?.name }}</td>
          <td>{{ registration.course.coach.firstname }} {{ registration.course.coach.lastname }}</td>
        </tr>
      </ng-template>
      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="5" class="text-center p-4">
            @if (!activeDog) {
              <div class="flex flex-col items-center py-4">
                <i class="pi pi-info-circle text-3xl mb-2 text-blue-500"></i>
                <p class="text-lg">Aucun chien sélectionné. Veuillez sélectionner un chien pour voir son historique de cours.</p>
              </div>
            } @else if (activeDog && !dateFilter) {
              <div class="flex flex-col items-center py-4">
                <i class="pi pi-calendar-times text-3xl mb-2 text-blue-500"></i>
                <p class="text-lg">{{ activeDog.name }} n'a pas encore participé à des cours.</p>
              </div>
            } @else if (activeDog && dateFilter) {
              <div class="flex flex-col items-center py-4">
                <i class="pi pi-filter-slash text-3xl mb-2 text-blue-500"></i>
                <p class="text-lg">Aucun cours trouvé pour {{ activeDog.name }} à partir du {{ dateFilter | date:'dd/MM/yyyy':'':'fr' }}.</p>
              </div>
            }
          </td>
        </tr>
      </ng-template>
    </p-table>
  </div>

  <!-- Accordéon pour tablette et mobile -->
  <div class="block lg:hidden">
    @if (filteredRegistrations && filteredRegistrations.length > 0) {
      <p-accordion [multiple]="false" styleClass="w-full" value="0">
        @for (registration of filteredRegistrations; track registration.id) {
          <p-accordionpanel [value]="registration.id">
            <p-accordionheader>
              <div class="flex justify-between items-center w-full">
                <div class="flex flex-col">
                  <span class="font-semibold text-base">{{ registration.course.title }}</span>
                  <span class="text-sm text-gray-600">{{ registration.course.startDatetime | date:'d MMMM yyyy':'':'fr' }}</span>
                </div>
                <span class="text-sm font-medium text-primary">{{ registration.course.startDatetime | date:'HH:mm':'':'fr' }}</span>
              </div>
            </p-accordionheader>
            <p-accordioncontent>
              <div class="space-y-3 pt-2">
                <div class="flex items-center justify-between border-b border-gray-100 pb-2">
                  <span class="text-sm font-medium text-gray-700">Horaire :</span>
                  <span class="text-sm">{{ registration.course.startDatetime | date:'HH:mm':'':'fr' }} - {{ registration.course.endDatetime | date:'HH:mm':'':'fr' }}</span>
                </div>

                <div class="flex items-center justify-between border-b border-gray-100 pb-2">
                  <span class="text-sm font-medium text-gray-700">Type de cours :</span>
                  <span class="text-sm">{{ registration.course.courseType.name }}</span>
                </div>

                <div class="flex items-center justify-between">
                  <span class="text-sm font-medium text-gray-700">Coach :</span>
                  <span class="text-sm">{{ registration.course.coach.firstname }} {{ registration.course.coach.lastname }}</span>
                </div>
              </div>
            </p-accordioncontent>
          </p-accordionpanel>
        }
      </p-accordion>
    } @else {
      <div class="text-center p-8 bg-gray-50 rounded-lg">
        @if (!activeDog) {
          <div class="flex flex-col items-center">
            <i class="pi pi-info-circle text-4xl mb-4 text-blue-500"></i>
            <h3 class="text-lg font-semibold mb-2">Aucun chien sélectionné</h3>
            <p class="text-gray-600">Veuillez sélectionner un chien pour voir son historique de cours.</p>
          </div>
        } @else if (activeDog && !dateFilter) {
          <div class="flex flex-col items-center">
            <i class="pi pi-calendar-times text-4xl mb-4 text-blue-500"></i>
            <h3 class="text-lg font-semibold mb-2">Aucun cours</h3>
            <p class="text-gray-600">{{ activeDog.name }} n'a pas encore participé à des cours.</p>
          </div>
        } @else if (activeDog && dateFilter) {
          <div class="flex flex-col items-center">
            <i class="pi pi-filter-slash text-4xl mb-4 text-blue-500"></i>
            <h3 class="text-lg font-semibold mb-2">Aucun résultat</h3>
            <p class="text-gray-600">Aucun cours trouvé pour {{ activeDog.name }} à partir du {{ dateFilter | date:'dd/MM/yyyy':'':'fr' }}.</p>
          </div>
        }
      </div>
    }
  </div>
</p-card>
